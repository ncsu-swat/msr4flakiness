@Test
public void testMappingGraphFromNodes() {
    final String workflowName = "test-workflow";
    final String condition = "condition";
    final ExplicitNode A = new ExplicitNode("A", EmailActionBuilder.create().build());
    final ExplicitNode B = new ExplicitNode("B", EmailActionBuilder.create().build());
    final ExplicitNode C = new ExplicitNode("C", EmailActionBuilder.create().build());
    final ExplicitNode D = new ExplicitNode("D", EmailActionBuilder.create().build());
    final ExplicitNode E = new ExplicitNode("E", EmailActionBuilder.create().build());
    final Start start = new Start("start");
    final End end = new End("end");
    final Fork fork = new Fork("fork1");
    final Join join = new Join("join1", fork);
    final Decision decision = new Decision("decision");
    final DecisionJoin decisionJoin = new DecisionJoin("decisionJoin", decision);
    // TODO: Unfortunately the order of the elements counts.
    end.addParent(join);
    join.addParent(decisionJoin);
    join.addParent(C);
    decisionJoin.addParent(D);
    decisionJoin.addParent(E);
    D.addParentWithCondition(decision, Condition.actualCondition(condition));
    E.addParentDefaultConditional(decision);
    decision.addParent(B);
    B.addParent(fork);
    C.addParent(fork);
    fork.addParent(A);
    A.addParent(start);
    final GraphNodes graphNodes = new GraphNodes(workflowName, null, null, null, start, end, Arrays.asList(A, B, C, D, E, fork, join, decision, decisionJoin));
    final WORKFLOWAPP expectedWorkflowApp = OBJECT_FACTORY.createWORKFLOWAPP();
    expectedWorkflowApp.setName(workflowName);
    final START startJaxb = OBJECT_FACTORY.createSTART();
    startJaxb.setTo(start.getChild().getName());
    expectedWorkflowApp.setStart(startJaxb);
    final END endJaxb = OBJECT_FACTORY.createEND();
    endJaxb.setName(end.getName());
    expectedWorkflowApp.setEnd(endJaxb);
    final List<Object> nodesInWorkflowApp = expectedWorkflowApp.getDecisionOrForkOrJoin();
    final FORK forkJaxb = OBJECT_FACTORY.createFORK();
    forkJaxb.setName(fork.getName());
    final List<FORKTRANSITION> transitions = forkJaxb.getPath();
    final FORKTRANSITION transitionB = OBJECT_FACTORY.createFORKTRANSITION();
    transitionB.setStart(B.getName());
    final FORKTRANSITION transitionC = OBJECT_FACTORY.createFORKTRANSITION();
    transitionC.setStart(C.getName());
    transitions.add(transitionB);
    transitions.add(transitionC);
    final ACTION actionA = convertEmailActionByHand(A);
    final ACTION actionB = convertEmailActionByHand(B);
    final ACTION actionC = convertEmailActionByHand(C);
    final DECISION decisionJaxb = OBJECT_FACTORY.createDECISION();
    decisionJaxb.setName(decision.getName());
    final SWITCH _switch = OBJECT_FACTORY.createSWITCH();
    final List<CASE> cases = _switch.getCase();
    final CASE _case = OBJECT_FACTORY.createCASE();
    _case.setTo(D.getName());
    _case.setValue(condition);
    cases.add(_case);
    final DEFAULT _default = OBJECT_FACTORY.createDEFAULT();
    _default.setTo(E.getName());
    _switch.setDefault(_default);
    decisionJaxb.setSwitch(_switch);
    final ACTION actionD = convertEmailActionByHand(D);
    final ACTION actionE = convertEmailActionByHand(E);
    final JOIN joinJaxb = OBJECT_FACTORY.createJOIN();
    joinJaxb.setName(join.getName());
    joinJaxb.setTo(end.getName());
    // TODO: Unfortunately the order of the elements counts.
    nodesInWorkflowApp.add(createKill());
    nodesInWorkflowApp.add(actionA);
    nodesInWorkflowApp.add(actionB);
    nodesInWorkflowApp.add(actionC);
    nodesInWorkflowApp.add(actionD);
    nodesInWorkflowApp.add(actionE);
    nodesInWorkflowApp.add(forkJaxb);
    nodesInWorkflowApp.add(joinJaxb);
    nodesInWorkflowApp.add(decisionJaxb);
    final WORKFLOWAPP workflowapp = DozerBeanMapperSingleton.instance().map(graphNodes, WORKFLOWAPP.class);
    assertEquals(expectedWorkflowApp, workflowapp);
}
